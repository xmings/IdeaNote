{% extends 'base.html' %}

{% block cssdefine %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/highlight-default.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.contextmenu.min.css') }}">
    <style>
        #catalog-tree {
            font-size: 12px;
            margin-left: 0;
        }

        #catalog-tree > #root {
            padding-left: 0;
        }

        .contextmenu-item-custom {
            font-size: 12px;
            font-family: inherit;

        }

        .context-menu-active {
            background-color: #FFE6B0;
        }

        #markdown-editor {
            width: 100%;
            margin-right: 10px;
            font-size: 14px;
            line-height: 20px;
            line-grid: create;
            resize: none;
            border: none;
            outline: none;

        }

        #markdown-editor:hover {
            border-color: white;
            box-shadow: none;
            outline: 0;
        }

        #markdown-editor:visited,
        #markdown-editor:active,
        #markdown-editor:focus {
            border-color: white;
            box-shadow: none;
            outline: 0;
        }
        .splitter_panel .vsplitter {
            width: 2px;
            background-color: rgba(128, 128, 128, 0.18);
        }


    </style>
{% endblock %}

{% block jsdefinebefore %}
    <script src="{{ url_for('static', filename='js/marked.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/highlight.pack.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.contextmenu.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.ui.position.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/hotkeys.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.inline-attachment.js') }}"></script>

    <script>
        hljs.tabReplace = ' ';
        hljs.initHighlightingOnLoad();
    </script>
{% endblock %}


{% block centerframe %}
    <textarea id="markdown-editor" class="form-control" placeholder="写你想写"></textarea>
{% endblock %}


{% block jsdefineafter %}
    <script type="text/javascript">
        $(document).ready(function () {
            preview = function(content) {
                //x=content.replace(/#\\n/g, '\n\n');
                $(".preview").html(marked(content,
                        {
                            highlight: function (code) {
                                return hljs.highlightAuto(code).value;
                            },
                            pedantic: false,
                            gfm: true,
                            tables: true,
                            breaks: false,
                            sanitize: false,
                            smartLists: true,
                            smartypants: false,
                            xhtml: false
                        }
                    )
                );
            };

            editor = $("#markdown-editor");
            editor.keyup(function () {
                content = this.value;
                if (content !== undefined) {
                    preview(content);

                    currentNode = zTreeObj.getSelectedNodes();
                    if (currentNode.length > 0) {
                        node = zTreeObj.getSelectedNodes()[0];
                        $.ajax({
                            url: "{{ url_for('core.updateNode', type='content') }}",
                            type: "post",
                            data: {
                                nodeId: node.id,
                                content: content,
                            },
                            success: function () {

                            },
                            dataType: 'json'
                        })
                    }


                }

            });
            
            save = function() {
                $.post(

                    
                )
            };

            hotkeys('ctrl+s,ctrl+e', function (event, handler) {
                console.log(event, handler);
                switch (handler.key) {
                    case "ctrl+s":
                        save();
                        break;
                    case "ctrl+e":
                        alert('you pressed ctrl+b!');
                        break;
                }
            });

        });

    </script>
{% endblock %}
{% block leftframe %}
    {% include 'catalog.html' %}
{% endblock %}